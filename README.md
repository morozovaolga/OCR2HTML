OCR → HTML (с сохранением абзацев и корректурой)

Этот мини‑репозиторий берёт PDF с уже распознанным (OCR) текстовым слоем, восстанавливает абзацы и заголовки по макету, применяет правила дореволюционной орфографии (oldspelling), затем нормализует по современным правилам русской орфографии/пунктуации и выдаёт итоговый HTML/TXT.

Требования
- Python 3.10+
- pip
- Windows/macOS/Linux (на Windows удобен PowerShell)

Установка (рекомендуется venv)
Windows PowerShell:
- python -m venv .venv
- .\.venv\Scripts\Activate.ps1
- python -m pip install --upgrade pip
- pip install -r requirements.txt

macOS/Linux:
- python3 -m venv .venv
- source .venv/bin/activate
- python -m pip install --upgrade pip
- pip install -r requirements.txt

Быстрый старт
- Подготовьте PDF с уже распознанным текстовым слоем (OCR). Если ваш PDF — чистые картинки без текста, сначала прогоните OCR вне этого проекта (например, Tesseract, Abbyy, etc.).
- Запустите конвейер:
  - python pipeline.py --pdf path/to/file.pdf --outdir out --title "Мой документ (современная версия)"

Что получится в папке out/
- structured.json — извлечённые блоки текста по страницам (с ролями heading/paragraph)
- structured.html / structured.txt — черновой вывод после структурирования
- structured_rules.json — результат применения правил oldspelling ко всем блокам
- final.html — современная орфография/типографика, аккуратные абзацы (основной HTML)
- final.txt — плоский текст финальной версии
- flags.json — список отмеченных неоднозначных замен (подсветка «старых» букв и смешанной латиницы)

Как это работает (этапы)
1) Извлечение структуры (extract_structured_text.py)
   - Читает PDF через PyMuPDF, собирает текстовые блоки, по простым эвристикам определяет заголовки/абзацы, сохраняет порядок чтения.
2) Применение правил дореформенной орфографии (apply_rules_structured.py)
   - Извлекает пары (паттерн, замена) из файла oldspelling.py и применяет их к каждому блоку.
3) Современная орфография и типографика (modernize_structured.py)
   - Нормализует переносы/тире/многоточия/пробелы, склеивает абзацы, переводит «ѣ/і/ѳ/ѵ/ъ (на конце)» в современную форму, помечает неоднозначные места.

Частые вопросы
- PDF «немой» (только картинки)?
  - Этот инструмент не выполняет OCR. Сначала прогоните OCR (любой удобный инструмент), получите PDF с текстовым слоем и запустите pipeline.py как описано выше.
- Хочу тонкую настройку правил.
  - Отредактируйте oldspelling.py (паттерны re.sub). Конвейер автоматически вытащит пары замен и применит их.

Команда и параметры
- python pipeline.py --pdf t1.pdf --outdir output_vol2 --title "t1.pdf (современная, структурированная)"
  - --pdf — путь к PDF
  - --outdir — папка вывода (будет создана)
  - --title — заголовок для HTML

Структура папки
- pipeline.py — единая точка входа (оркестратор шагов)
- extract_structured_text.py — извлечение блоков текста и ролей
- apply_rules_structured.py — применение правил oldspelling к структуре
- modernize_structured.py — модернизация орфографии/пунктуации, финальный HTML/TXT/flags
- oldspelling.py — правила дореформенной орфографии (реестр замен)
- requirements.txt — зависимости (PyMuPDF)
- .gitignore — служебные исключения



